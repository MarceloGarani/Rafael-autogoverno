# Story 4.2: Evolution Charts

**Epic:** 4 — Intelligence & Reports
**Status:** Draft
**Priority:** High
**Story Type:** Frontend + API

---

## Executor Assignment

executor: "@dev"
quality_gate: "@architect"
quality_gate_tools: ["architecture-review", "code-standards"]

---

## Story Statement

> As a mentee,
> I want to see charts showing my emotional evolution over time,
> so that I can visualize my growth.

---

## Acceptance Criteria

- [ ] **AC1:** Rota `/progress` com dashboard de evolução pessoal
- [ ] **AC2:** Gráfico de linha (Recharts): intensidade emocional média por semana ao longo do tempo
- [ ] **AC3:** Gráfico de pizza/donut: distribuição de categorias (onde a pressão mais aparece)
- [ ] **AC4:** Indicador de % reativo vs. estratégico com evolução mensal (bar chart ou gauge)
- [ ] **AC5:** Seção de streaks e badges conquistados (streak atual, maior streak, total de registros)
- [ ] **AC6:** Dados carregados via API Route (`GET /api/progress`) com agregações server-side
- [ ] **AC7:** Gráficos responsivos — funcionam bem em mobile e desktop
- [ ] **AC8:** Período selecionável: último mês, últimos 3 meses, todo o período

---

## Dev Notes

### Component Specs
[Source: docs/architecture.md#components]
- Progress Dashboard: `IntensityChart` (line), `CategoryPieChart` (pie/donut), `ReactiveVsStrategicChart` (bar/gauge), `StreakCounter`, `BadgeGrid`
- Dependencies: Recharts 2.x
- Technology: Client Components (Recharts requires client-side rendering)

### API Endpoint
[Source: docs/architecture.md#api-specification]
- `GET /api/progress` — returns aggregated data for authenticated user
- Query params: `period` (month|3months|all)
- Response: `{ intensity_by_week[], category_distribution[], reactive_vs_strategic[], streak, max_streak, total_entries, badges[] }`

### Chart Data Structures
```typescript
// Intensity by week (line chart)
{ week: "2026-W08", avg_intensity: 6.5 }[]

// Category distribution (pie chart)
{ category: "audiencia", count: 12, percentage: 30 }[]

// Reactive vs Strategic (bar chart)
{ month: "2026-02", reactive_pct: 60, strategic_pct: 30, unsure_pct: 10 }[]
```

### Intensity Color Scale
[Source: docs/architecture/design-system.md]
- 1-3: #4CAF50 (green) — low intensity
- 4-6: #FFC107 (yellow) — medium
- 7-10: #E53935 (red) — high

### Recharts Configuration
- Line chart: `<LineChart>` with `<Line>` stroke based on intensity color
- Pie chart: `<PieChart>` with `<Pie>` custom colors per category
- Bar chart: `<BarChart>` with stacked bars for reactive/strategic/unsure
- Responsive: `<ResponsiveContainer width="100%" height={300}>`

### File Locations
- Page: `packages/web/src/app/(mentee)/progress/page.tsx`
- API Route: `packages/web/src/app/api/progress/route.ts`
- Components: `packages/web/src/components/progress/` — IntensityChart.tsx, CategoryPieChart.tsx, ReactiveVsStrategicChart.tsx, StreakCounter.tsx, BadgeGrid.tsx
- Hook: `packages/web/src/hooks/use-progress.ts` (React Query)

---

## Tasks / Subtasks

- [ ] **Task 1** (AC: 6): Create API Route `GET /api/progress` — aggregate entries by week (avg intensity), category distribution, reactive vs strategic % by month, streak data, badges
- [ ] **Task 2** (AC: 8): Add period filter to API — last month, last 3 months, all time
- [ ] **Task 3** (AC: 2): Create `IntensityChart` — Recharts LineChart showing avg intensity per week, responsive
- [ ] **Task 4** (AC: 3): Create `CategoryPieChart` — Recharts PieChart/donut showing category distribution with percentages
- [ ] **Task 5** (AC: 4): Create `ReactiveVsStrategicChart` — bar chart showing monthly % of reactive, strategic, unsure
- [ ] **Task 6** (AC: 5): Create `StreakCounter` (reuse from home) and `BadgeGrid` — display badges earned with icons
- [ ] **Task 7** (AC: 1): Create progress page at `/progress` — compose all chart components with period selector
- [ ] **Task 8** (AC: 7): Ensure responsive behavior — charts resize properly on mobile (stacked layout) and desktop (grid layout)
- [ ] **Task 9**: Create `useProgress` React Query hook with period parameter
- [ ] **Task 10**: Write unit tests for data aggregation logic and chart component rendering

---

## CodeRabbit Integration

> **CodeRabbit Integration**: Disabled

---

## File List

_To be updated during implementation._

---

## Dev Agent Record

_To be filled by @dev during implementation._

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-02-27 | 1.0 | Story drafted | @sm |

---

## QA Results

_To be filled by @qa during review._
