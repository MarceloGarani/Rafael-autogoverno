# Story 5.3: PWA Configuration

**Epic:** 5 — Engagement & PWA
**Status:** Draft
**Priority:** Medium
**Story Type:** Deployment/Infrastructure + Frontend

---

## Executor Assignment

executor: "@dev"
quality_gate: "@architect"
quality_gate_tools: ["architecture-review", "code-standards"]

---

## Story Statement

> As a mentee,
> I want to install the app on my phone like a native app,
> so that I can access it quickly without opening a browser.

---

## Acceptance Criteria

- [ ] **AC1:** Web App Manifest configurado com: nome, short_name, ícones, theme_color (#000000), background_color (#000000), display: standalone
- [ ] **AC2:** Service Worker básico registrado para caching de assets estáticos
- [ ] **AC3:** App instalável via "Adicionar à tela inicial" no Chrome/Safari mobile
- [ ] **AC4:** Ícone do app na tela inicial com branding adequado
- [ ] **AC5:** Splash screen configurada no manifest
- [ ] **AC6:** Meta tags adequadas para iOS (apple-mobile-web-app-capable, status-bar-style)
- [ ] **AC7:** Funciona corretamente quando aberta como standalone (sem barra do browser)

---

## Dev Notes

### PWA Configuration
[Source: docs/architecture.md#tech-stack]
- Package: `next-pwa` (next-pwa for manifest + service worker with zero config)
- Theme color: #000000 (black, matching dark mode)
- Background color: #000000

### Manifest Fields
```json
{
  "name": "Diário de Autogoverno",
  "short_name": "Autogoverno",
  "description": "Registro diário de autogoverno emocional para advogados",
  "start_url": "/",
  "display": "standalone",
  "background_color": "#000000",
  "theme_color": "#000000",
  "orientation": "portrait",
  "icons": [
    { "src": "/icons/icon-192.png", "sizes": "192x192", "type": "image/png" },
    { "src": "/icons/icon-512.png", "sizes": "512x512", "type": "image/png" },
    { "src": "/icons/icon-maskable-512.png", "sizes": "512x512", "type": "image/png", "purpose": "maskable" }
  ]
}
```

### iOS Meta Tags
```html
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<meta name="apple-mobile-web-app-title" content="Autogoverno" />
<link rel="apple-touch-icon" href="/icons/apple-touch-icon.png" />
```

### Service Worker Strategy
- Cache strategy: stale-while-revalidate for pages, cache-first for static assets
- Minimal caching for MVP — focus on installability and offline shell
- next-pwa handles SW generation automatically

### Design Constraints
[Source: docs/architecture/design-system.md]
- App icon: should use black background with red (#E53935) accent
- Splash screen: black background, app name in white, simple

### File Locations
- next-pwa config: `packages/web/next.config.js` (wrap with `withPWA`)
- Manifest: `packages/web/public/manifest.json`
- Icons: `packages/web/public/icons/` — icon-192.png, icon-512.png, icon-maskable-512.png, apple-touch-icon.png
- Meta tags: `packages/web/src/app/layout.tsx` (head section)

---

## Tasks / Subtasks

- [ ] **Task 1** (AC: 2): Install `next-pwa` and configure in `next.config.js` — wrap Next.js config with `withPWA()`
- [ ] **Task 2** (AC: 1): Create `manifest.json` in `public/` with all required fields (name, icons, colors, display mode)
- [ ] **Task 3** (AC: 4, 5): Create PWA icons — 192x192, 512x512, maskable 512x512, apple-touch-icon (black bg, red accent design)
- [ ] **Task 4** (AC: 6): Add iOS meta tags to root layout head — apple-mobile-web-app-capable, status-bar-style, apple-touch-icon
- [ ] **Task 5** (AC: 1): Add manifest link in root layout: `<link rel="manifest" href="/manifest.json" />`
- [ ] **Task 6** (AC: 2): Configure service worker caching strategy — stale-while-revalidate for pages, cache-first for static assets
- [ ] **Task 7** (AC: 3, 7): Test installability — verify "Add to Home Screen" works on Chrome Android and Safari iOS, verify standalone mode works without browser chrome
- [ ] **Task 8**: Verify PWA score with Lighthouse audit (target: 90+)

---

## CodeRabbit Integration

> **CodeRabbit Integration**: Disabled

---

## File List

_To be updated during implementation._

---

## Dev Agent Record

_To be filled by @dev during implementation._

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-02-27 | 1.0 | Story drafted | @sm |

---

## QA Results

_To be filled by @qa during review._
