# Story 2.1: Daily Entry Stepper (Steps 1-3)

**Epic:** 2 — Daily Entry & AI Reflection
**Status:** Draft
**Priority:** Critical Path
**Story Type:** Frontend + API

---

## Executor Assignment

executor: "@dev"
quality_gate: "@architect"
quality_gate_tools: ["architecture-review", "code-standards"]

---

## Story Statement

> As a mentee,
> I want to register my daily entry through a guided 3-step form,
> so that I can document my emotional experience quickly and easily.

---

## Acceptance Criteria

- [ ] **AC1:** Rota `/entry/new` com stepper de 3 steps com indicador de progresso visual
- [ ] **AC2:** Step 1 "O que aconteceu?": Campo de texto livre (placeholder: "Descreva a situação de pressão, conflito ou decisão que enfrentou hoje") + chips clicáveis de categoria (Audiência, Negociação, Cliente, Cobrança, Equipe, Decisão, Outro)
- [ ] **AC3:** Step 2 "O que você sentiu?": Seleção de emoção com ícones visuais (Ansiedade, Raiva, Medo, Frustração, Insegurança, Culpa, Outro) + slider de intensidade 1-10 com feedback visual de cor (verde → amarelo → vermelho)
- [ ] **AC4:** Step 3 "Como você reagiu?": Campo de texto livre (placeholder: "O que você fez ou disse?") + seleção rápida de autopercepção (Reativa, Estratégica, Não sei)
- [ ] **AC5:** Botão "Voltar" em cada step (exceto o primeiro)
- [ ] **AC6:** Botão "Salvar e refletir →" no step 3
- [ ] **AC7:** Validação: situação (obrigatório, min 10 chars), categoria (obrigatória), emoção (obrigatória), intensidade (obrigatória), reação (obrigatório, min 10 chars), autopercepção (obrigatória)
- [ ] **AC8:** Dados salvos no Supabase via API Route (`POST /api/entries`)
- [ ] **AC9:** UI mobile-first com interações por toque (chips, slider)
- [ ] **AC10:** Estado do formulário preservado entre steps (sem perda de dados ao navegar)

---

## Dev Notes

### Wireframe — Step 1 "O que aconteceu?"
[Source: docs/architecture/wireframes-mvp-phase1.md#4-entry-step-1]
```
┌────────────────────────────────┐
│  ←                  1 ●──○──○ │
│                                │
│  O que aconteceu?              │
│                                │
│  ┌────────────────────────┐    │
│  │ Descreva a situação... │    │
│  │                        │    │
│  │                        │    │
│  └────────────────────────┘    │
│                                │
│  Categoria                     │
│  ┌──────┐ ┌──────┐ ┌──────┐   │
│  │ Aud  │ │ Neg  │ │ Cli  │   │
│  └──────┘ └──────┘ └──────┘   │
│  ┌──────┐ ┌──────┐ ┌──────┐   │
│  │ Cob  │ │ Equi │ │ Dec  │   │
│  └──────┘ └──────┘ └──────┘   │
│         ┌──────┐               │
│         │ Outro│               │
│         └──────┘               │
│                                │
│  ┌────────────────────────┐    │
│  │     PRÓXIMO →          │    │
│  └────────────────────────┘    │
└────────────────────────────────┘
```

### Wireframe — Step 2 "O que você sentiu?"
[Source: docs/architecture/wireframes-mvp-phase1.md#5-entry-step-2]
- Emotion picker: grid of icons (Ansiedade, Raiva, Medo, Frustração, Insegurança, Culpa, Outro)
- Intensity slider: 1-10, color gradient green→yellow→red
- Label shows current value ("Intensidade: 7")

### Wireframe — Step 3 "Como você reagiu?"
[Source: docs/architecture/wireframes-mvp-phase1.md#6-entry-step-3]
- Textarea for reaction description
- Three chips: Reativa (bordered), Estratégica (bordered), Não sei (bordered)
- Active chip: filled with #E53935

### Component Specs
[Source: docs/architecture.md#components]
- Entry Stepper: `EntryForm`, `StepSituation`, `StepEmotion`, `StepReaction`, `IntensitySlider`, `CategoryChips`, `EmotionPicker`
- Dependencies: React Hook Form (or Zustand for form state), API route `/api/entries`
- Technology: Client Components (interactivity), mobile-first, touch-optimized

### State Management
[Source: docs/architecture.md#state-management]
```typescript
entryDraft: Partial<DailyEntry> | null;
setEntryDraft: (draft: Partial<DailyEntry> | null) => void;
```
- Use Zustand store to persist form data between steps

### API Endpoint
[Source: docs/architecture.md#api-specification]
- `POST /api/entries`
- Request body: `{ date, situation, category, emotion, intensity, reaction, self_perception }`
- Response: `{ id: entry_id, status: "created" }`
- Auth: Mentee/Mentor (authenticated)

### Enums
[Source: docs/architecture.md#data-models]
```typescript
type Category = 'audiencia' | 'negociacao' | 'cliente' | 'cobranca' | 'equipe' | 'decisao' | 'outro';
type Emotion = 'ansiedade' | 'raiva' | 'medo' | 'frustracao' | 'inseguranca' | 'culpa' | 'outro';
type SelfPerception = 'reactive' | 'strategic' | 'unsure';
```

### Category Display Labels
- audiencia → "Audiência"
- negociacao → "Negociação"
- cliente → "Cliente"
- cobranca → "Cobrança"
- equipe → "Equipe"
- decisao → "Decisão"
- outro → "Outro"

### Intensity Color Scale
[Source: docs/architecture/design-system.md]
- 1-3: #4CAF50 (green)
- 4-6: #FFC107 (yellow)
- 7-10: #E53935 (red)

### File Locations
- Page: `packages/web/src/app/(mentee)/entry/new/page.tsx`
- Components: `packages/web/src/components/entry/` — EntryForm.tsx, StepSituation.tsx, StepEmotion.tsx, StepReaction.tsx, IntensitySlider.tsx, CategoryChips.tsx, EmotionPicker.tsx
- API Route: `packages/web/src/app/api/entries/route.ts`
- Service: `packages/web/src/lib/services/entry-service.ts`
- DB: `packages/web/src/lib/db/entries.ts`
- Constants: `packages/web/src/lib/utils/constants.ts` (category/emotion labels and icons)

---

## Tasks / Subtasks

- [ ] **Task 1** (AC: 10): Create Zustand store for entry draft state (preserves data between steps)
- [ ] **Task 2** (AC: 1): Create `EntryForm` wrapper component with stepper progress indicator (3 dots/circles showing current step)
- [ ] **Task 3** (AC: 2): Create `StepSituation` — textarea with placeholder + `CategoryChips` component (7 chips in flex wrap)
- [ ] **Task 4** (AC: 3): Create `StepEmotion` — `EmotionPicker` with icon grid (7 emotions) + `IntensitySlider` (1-10, color gradient)
- [ ] **Task 5** (AC: 4): Create `StepReaction` — textarea + 3 autopercepção chips (Reativa, Estratégica, Não sei)
- [ ] **Task 6** (AC: 5, 6): Add navigation buttons — "Voltar" (steps 2-3), "Próximo →" (steps 1-2), "Salvar e refletir →" (step 3)
- [ ] **Task 7** (AC: 7): Implement form validation — situation min 10 chars, all required fields, reaction min 10 chars
- [ ] **Task 8** (AC: 8): Create API Route `POST /api/entries` — validate request, insert into `daily_entries`, return entry_id
- [ ] **Task 9** (AC: 8): Create entry service (`entry-service.ts`) and DB query layer (`entries.ts`)
- [ ] **Task 10**: Create constants file with category/emotion labels, icons, and color mappings
- [ ] **Task 11** (AC: 9): Optimize for mobile touch — large tap targets (min 44px), chip spacing, slider thumb size
- [ ] **Task 12**: After successful save, redirect to `/reflection/{entry_id}` for AI reflection
- [ ] **Task 13**: Write unit tests for EntryForm, validation, IntensitySlider, and API route

---

## CodeRabbit Integration

> **CodeRabbit Integration**: Disabled

---

## File List

_To be updated during implementation._

---

## Dev Agent Record

_To be filled by @dev during implementation._

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-02-27 | 1.0 | Story drafted | @sm |

---

## QA Results

_To be filled by @qa during review._
