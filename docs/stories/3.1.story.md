# Story 3.1: Mentor Dashboard Overview

**Epic:** 3 — Mentor Dashboard & Mentee Management
**Status:** Draft
**Priority:** High
**Story Type:** Frontend + API

---

## Executor Assignment

executor: "@dev"
quality_gate: "@architect"
quality_gate_tools: ["architecture-review", "code-standards"]

---

## Story Statement

> As a mentor,
> I want to see a summary of all mentee activity at a glance,
> so that I can quickly identify who needs attention.

---

## Acceptance Criteria

- [ ] **AC1:** Rota `/dashboard` acessível apenas para role `mentor`
- [ ] **AC2:** Layout desktop-first com sidebar de navegação (Visão Geral, Mentorados, Insights, Meu Diário, Configurações)
- [ ] **AC3:** Cards de resumo: Total de mentorados ativos, Registros esta semana, Engajamento médio (% que registrou nos últimos 2 dias), Alertas pendentes
- [ ] **AC4:** Lista de alertas: mentorados que não registram há 3+ dias com nome e dias de inatividade
- [ ] **AC5:** Atividade recente: últimos 10 registros de mentorados (nome, data, categoria, intensidade — sem detalhes do conteúdo)
- [ ] **AC6:** Dados carregados via API Route (`GET /api/dashboard/overview`) com RLS de mentor
- [ ] **AC7:** Registros pessoais do mentor NÃO aparecem nas métricas do dashboard
- [ ] **AC8:** Loading states para cada seção independente

---

## Dev Notes

### Wireframe — Mentor Dashboard Overview
[Source: docs/architecture/wireframes-mvp-phase1.md#10-mentor-dashboard]
```
┌────────────┬──────────────────────────────────────┐
│  SIDEBAR   │  Dashboard — Visão Geral             │
│  240px     │                                      │
│            │  ┌────────┐ ┌────────┐ ┌────────┐    │
│  Visão     │  │12 Ativ │ │48 Reg  │ │75% Eng │    │
│  Geral ◄── │  └────────┘ └────────┘ └────────┘    │
│            │  ┌────────┐                           │
│  Mentorados│  │3 Alert │                           │
│            │  └────────┘                           │
│  Insights  │                                      │
│            │  Alertas                              │
│  ────────  │  ┌────────────────────────────────┐   │
│  Meu Diário│  │ ● João Silva — 5 dias inativo  │   │
│            │  │ ● Maria Santos — 3 dias inativa │   │
│  Config    │  └────────────────────────────────┘   │
│            │                                      │
│            │  Atividade Recente                    │
│            │  ┌────────────────────────────────┐   │
│            │  │ Ana · 27 fev · Audiência · 8   │   │
│            │  │ Pedro · 26 fev · Cliente · 5   │   │
│            │  └────────────────────────────────┘   │
└────────────┴──────────────────────────────────────┘
```

### API Endpoint
[Source: docs/architecture.md#api-specification]
- `GET /api/dashboard/overview` — Auth: Mentor only
- Returns: `{ total_mentees, entries_this_week, engagement_pct, alerts_count, alerts[], recent_activity[] }`
- Mentor's own entries EXCLUDED from all metrics

### Component Specs
[Source: docs/architecture.md#components]
- Mentor Dashboard Shell: `DashboardLayout`, `Sidebar`
- Dashboard components: `OverviewCards`, `AlertList`
- Loading: Independent skeleton for each card/section

### Data Aggregations
- Total mentees: COUNT users WHERE role = 'mentee'
- Entries this week: COUNT daily_entries WHERE date >= this_week_start AND user_id != mentor_id
- Engagement: (COUNT DISTINCT users with entry in last 2 days) / (total mentees) × 100
- Alerts: users WHERE last entry date > 3 days ago, ordered by days inactive DESC
- Recent activity: last 10 daily_entries (excluding mentor's), joined with user name

### File Locations
- Page: `packages/web/src/app/(mentor)/dashboard/page.tsx`
- API Route: `packages/web/src/app/api/dashboard/overview/route.ts`
- Components: `packages/web/src/components/dashboard/` — OverviewCards.tsx, AlertList.tsx, RecentActivity.tsx
- Service: `packages/web/src/lib/services/dashboard-service.ts`
- Hook: `packages/web/src/hooks/use-dashboard.ts`

---

## Tasks / Subtasks

- [ ] **Task 1** (AC: 1, 2): Create dashboard page at `(mentor)/dashboard/page.tsx` — uses mentor sidebar layout, protected by middleware (mentor role only)
- [ ] **Task 2** (AC: 6): Create API Route `GET /api/dashboard/overview` — aggregates all dashboard data, excludes mentor's own entries
- [ ] **Task 3** (AC: 6, 7): Create `dashboard-service.ts` with aggregation queries — total mentees, entries this week, engagement %, alerts, recent activity
- [ ] **Task 4** (AC: 3): Create `OverviewCards` component — 4 cards (Mentorados Ativos, Registros Semana, Engajamento, Alertas) with metric values
- [ ] **Task 5** (AC: 4): Create `AlertList` component — mentees inactive 3+ days, showing name and days since last entry, ordered by urgency
- [ ] **Task 6** (AC: 5): Create `RecentActivity` component — last 10 entries (name, date, category, intensity), no content details for privacy
- [ ] **Task 7** (AC: 8): Add independent loading skeletons for each section (cards, alerts, activity)
- [ ] **Task 8**: Create `useDashboardOverview` React Query hook
- [ ] **Task 9**: Write unit tests for aggregation logic and dashboard components

---

## CodeRabbit Integration

> **CodeRabbit Integration**: Disabled

---

## File List

_To be updated during implementation._

---

## Dev Agent Record

_To be filled by @dev during implementation._

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-02-27 | 1.0 | Story drafted | @sm |

---

## QA Results

_To be filled by @qa during review._
