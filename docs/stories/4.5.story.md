# Story 4.5: Group Insights Panel

**Epic:** 4 — Intelligence & Reports
**Status:** Draft
**Priority:** Medium
**Story Type:** Frontend + API

---

## Executor Assignment

executor: "@dev"
quality_gate: "@architect"
quality_gate_tools: ["architecture-review", "code-standards"]

---

## Story Statement

> As a mentor,
> I want to see aggregated insights across all mentees,
> so that I can identify group trends and adjust my content/sessions.

---

## Acceptance Criteria

- [ ] **AC1:** Rota `/dashboard/insights` com painel de insights agregados
- [ ] **AC2:** "Top 3 emoções mais registradas esta semana" com contagem e percentual
- [ ] **AC3:** "Categoria mais desafiadora do grupo" com percentual
- [ ] **AC4:** "Evolução geral: intensidade média" com comparativo mensal (ex: "caiu de 7.2 para 6.1")
- [ ] **AC5:** Distribuição reativo vs. estratégico do grupo com evolução
- [ ] **AC6:** Dados agregados excluem registros pessoais do mentor
- [ ] **AC7:** Período selecionável: última semana, último mês
- [ ] **AC8:** Visualizações com Recharts (bar charts, line charts para tendências)

---

## Dev Notes

### API Endpoint
[Source: docs/architecture.md#api-specification]
- `GET /api/dashboard/insights` — Auth: Mentor
- Query params: `period` (week|month)
- Response: `{ top_emotions[], top_category, avg_intensity_current, avg_intensity_previous, reactive_vs_strategic }`

### Data Aggregations
- Top emotions: `SELECT emotion, COUNT(*) FROM daily_entries WHERE user_id != mentor_id GROUP BY emotion ORDER BY count DESC LIMIT 3`
- Top category: Same pattern for category
- Avg intensity: Current vs previous period comparison
- Reactive vs Strategic: `SELECT self_perception, COUNT(*) ... GROUP BY self_perception`
- ALL queries exclude mentor's own entries

### Component Specs
[Source: docs/architecture.md#components]
- Group Insights: `InsightsPanel`, `TopEmotionsChart`, `GroupEvolutionChart`
- Dependencies: Recharts for visualizations
- Technology: Client Components (charts)

### Chart Types
- Top emotions: Horizontal bar chart (emotion label + bar + count)
- Intensity evolution: Line chart (monthly average)
- Reactive vs Strategic: Stacked bar chart or pie chart (group-level)
- Category: Bar chart or pie chart

### File Locations
- Page: `packages/web/src/app/(mentor)/dashboard/insights/page.tsx`
- API Route: `packages/web/src/app/api/dashboard/insights/route.ts`
- Components: `packages/web/src/components/dashboard/` — InsightsPanel.tsx, TopEmotionsChart.tsx, GroupEvolutionChart.tsx, GroupCategoryChart.tsx
- Service: extend `dashboard-service.ts` with group insights aggregations

---

## Tasks / Subtasks

- [ ] **Task 1** (AC: 1, 6): Create API Route `GET /api/dashboard/insights` — aggregate group data excluding mentor's entries, support period filter
- [ ] **Task 2** (AC: 2): Create `TopEmotionsChart` — horizontal bar chart showing top 3 emotions with count and percentage
- [ ] **Task 3** (AC: 3): Create category summary — show most challenging category with percentage and bar visualization
- [ ] **Task 4** (AC: 4): Create intensity evolution widget — show current vs previous month avg intensity with directional indicator (↓ or ↑)
- [ ] **Task 5** (AC: 5): Create group reactive vs strategic chart — stacked bar or pie showing distribution with trend
- [ ] **Task 6** (AC: 8): Compose all charts into `InsightsPanel` with Recharts
- [ ] **Task 7** (AC: 7): Add period selector — Última Semana, Último Mês — updates all charts
- [ ] **Task 8** (AC: 1): Create insights page at `/dashboard/insights` with composed panel
- [ ] **Task 9**: Add loading skeletons for each chart section
- [ ] **Task 10**: Write unit tests for aggregation queries and chart rendering

---

## CodeRabbit Integration

> **CodeRabbit Integration**: Disabled

---

## File List

_To be updated during implementation._

---

## Dev Agent Record

_To be filled by @dev during implementation._

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-02-27 | 1.0 | Story drafted | @sm |

---

## QA Results

_To be filled by @qa during review._
