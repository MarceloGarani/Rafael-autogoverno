# Story 4.4: Pre-Session Briefing

**Epic:** 4 — Intelligence & Reports
**Status:** Draft
**Priority:** High
**Story Type:** API + Integration + Frontend

---

## Executor Assignment

executor: "@dev"
quality_gate: "@architect"
quality_gate_tools: ["architecture-review", "code-standards"]

---

## Story Statement

> As a mentor,
> I want to generate an AI-powered briefing before a mentoring session,
> so that I enter the session prepared with concrete insights.

---

## Acceptance Criteria

- [ ] **AC1:** Botão "Gerar briefing de sessão" no perfil do mentorado
- [ ] **AC2:** API Route (`POST /api/briefings`) que coleta registros desde a última sessão/briefing + notas do mentor e chama Claude API
- [ ] **AC3:** Briefing gerado contém: resumo dos registros (máx 3 parágrafos), padrões emocionais (conectados ao A.D.V.), pontos de atenção (intensidade 8+, padrões repetitivos), 3 sugestões de temas, perguntas sugeridas para o mentor fazer
- [ ] **AC4:** Briefing salvo na tabela `session_briefings`
- [ ] **AC5:** Briefing exibido em layout limpo, imprimível (CSS print-friendly)
- [ ] **AC6:** Histórico de briefings acessível no perfil do mentorado
- [ ] **AC7:** System prompt segue especificação do briefing: direto, prático, acionável para o mentor

---

## Dev Notes

### Claude API — Briefing System Prompt
[Source: diario-autogoverno-briefing.md]
- Tom: Direto, prático, acionável para o mentor
- Input: entries desde último briefing + notas do mentor
- Output: resumo (3 parágrafos), padrões emocionais (A.D.V.), atenção (intensidade 8+), 3 temas, perguntas sugeridas

### Session Briefing Data Model
[Source: docs/architecture.md#data-models]
```typescript
interface SessionBriefing {
  id: string;
  mentor_id: string;
  mentee_id: string;
  generated_at: string;
  summary: string;
  patterns: { description: string; adv_connection: string; }[];
  attention_points: string[];
  suggested_topics: string[];
  suggested_questions: string[];
  mentor_previous_notes: string;
}
```

### Core Workflow
[Source: docs/architecture.md#core-workflows]
```
1. Mentor clicks "Gerar briefing de sessão"
2. API collects entries since last briefing + mentor notes
3. Claude API generates structured briefing
4. Briefing saved to session_briefings table
5. Briefing displayed in clean, printable layout
```

### API Endpoints
[Source: docs/architecture.md#api-specification]
- `POST /api/briefings` — body: `{ mentee_id }`. Auth: Mentor. Generates and saves briefing
- `GET /api/briefings/[menteeId]` — returns briefing history for a mentee. Auth: Mentor

### Component Specs
[Source: docs/architecture.md#components]
- Session Briefing: `BriefingGenerator`, `BriefingView`, `PrintableBriefing`
- Client Component (generation button + loading), Server Component (view)
- CSS print styles for print-friendly output

### File Locations
- Briefing page: `packages/web/src/app/(mentor)/dashboard/briefing/[menteeId]/page.tsx`
- API Routes: `packages/web/src/app/api/briefings/route.ts`, `packages/web/src/app/api/briefings/[menteeId]/route.ts`
- Components: `packages/web/src/components/briefing/` — BriefingGenerator.tsx, BriefingView.tsx, PrintableBriefing.tsx
- AI Prompt: `packages/web/src/lib/ai/prompts.ts` (add briefing prompt)
- Service: extend or create `packages/web/src/lib/services/briefing-service.ts`

---

## Tasks / Subtasks

- [ ] **Task 1** (AC: 7): Create briefing system prompt in `prompts.ts` — direct, practical, actionable for mentor. Include A.D.V. framework connections
- [ ] **Task 2** (AC: 2): Create `briefing-service.ts` — collect entries since last briefing, fetch mentor notes, call Claude API, structure response
- [ ] **Task 3** (AC: 2): Create API Route `POST /api/briefings` — receives mentee_id, generates briefing, saves to DB, returns structured result
- [ ] **Task 4** (AC: 6): Create API Route `GET /api/briefings/[menteeId]` — returns chronological list of briefings for a mentee
- [ ] **Task 5** (AC: 1): Add "Gerar briefing de sessão" button in mentee profile page — loading state while generating
- [ ] **Task 6** (AC: 3, 5): Create `BriefingView` component — sections: Resumo, Padrões Emocionais, Pontos de Atenção, Sugestões de Temas, Perguntas Sugeridas, Notas Anteriores
- [ ] **Task 7** (AC: 5): Create `PrintableBriefing` with CSS print styles (`@media print`) — clean, black-on-white, no navigation
- [ ] **Task 8** (AC: 4): Save briefing to `session_briefings` table with all structured fields
- [ ] **Task 9** (AC: 6): Add briefing history section in mentee profile — list past briefings with dates, clickable
- [ ] **Task 10**: Write unit tests for briefing-service, prompt construction, and BriefingView

---

## CodeRabbit Integration

> **CodeRabbit Integration**: Disabled

---

## File List

_To be updated during implementation._

---

## Dev Agent Record

_To be filled by @dev during implementation._

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-02-27 | 1.0 | Story drafted | @sm |

---

## QA Results

_To be filled by @qa during review._
