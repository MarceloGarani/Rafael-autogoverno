# Story 3.4: Mentor-Practitioner Switch

**Epic:** 3 — Mentor Dashboard & Mentee Management
**Status:** Draft
**Priority:** Medium
**Story Type:** Frontend

---

## Executor Assignment

executor: "@dev"
quality_gate: "@architect"
quality_gate_tools: ["architecture-review", "code-standards"]

---

## Story Statement

> As a mentor (Rafael),
> I want to seamlessly switch between my mentor dashboard and my personal diary,
> so that I can practice what I teach without mixing contexts.

---

## Acceptance Criteria

- [ ] **AC1:** Item "Meu Diário" na sidebar do mentor que redireciona para a experiência de mentorado
- [ ] **AC2:** Na experiência de mentorado (quando é mentor), exibir botão/toggle "Voltar ao Dashboard" sempre visível
- [ ] **AC3:** A experiência de praticante é idêntica à do mentorado: home com streak, registro diário, reflexão IA, histórico, progresso
- [ ] **AC4:** Os dados pessoais do mentor são completamente isolados — não aparecem em nenhum endpoint do dashboard
- [ ] **AC5:** A transição é fluida — sem recarregamento completo da página (client-side routing)
- [ ] **AC6:** O contexto ativo (mentor vs praticante) é visualmente claro (indicador ou mudança de layout)

---

## Dev Notes

### Wireframe — Mentor Switch
[Source: docs/architecture/wireframes-mvp-phase1.md#12-mentor-switch]

**In Sidebar (Dashboard mode):**
- "Meu Diário" item below divider separator in sidebar
- Click → navigates to mentee experience (`/`)

**In Mentee mode (when user is mentor):**
- Floating button top-right: "← Voltar ao Dashboard"
- bg #212121, text white, always visible
- Click → navigates to `/dashboard`

### State Management
[Source: docs/architecture.md#state-management]
```typescript
mentorMode: 'dashboard' | 'diary';
setMentorMode: (mode: 'dashboard' | 'diary') => void;
```

### Data Isolation
[Source: docs/architecture.md#row-level-security]
- Mentor's own entries use the same `entries_own_read` policy (auth.uid() = user_id)
- Dashboard endpoints use `mentor_read_mentee_entries` policy which EXCLUDES mentor's own entries (`user_id != auth.uid()`)
- This ensures complete data isolation by design

### Routing
[Source: docs/architecture.md#routing-architecture]
- Dashboard mode: `/dashboard`, `/dashboard/mentees`, `/dashboard/insights`, etc.
- Diary mode: `/` (home), `/entry/new`, `/history`, `/progress`, `/reports`
- Both routes accessible to mentor role — middleware allows mentor to access mentee routes

### Visual Indicators
- In dashboard: sidebar visible, desktop layout
- In diary: bottom nav (mobile) or narrow centered layout, floating "Voltar ao Dashboard" button
- Layout component detects mentor role and diary mode to render appropriate navigation

### File Locations
- Switch component: `packages/web/src/components/layout/MentorSwitch.tsx`
- Mentee layout modification: `packages/web/src/app/(mentee)/layout.tsx` — add "Voltar ao Dashboard" for mentors
- Zustand store: already has `mentorMode` state

---

## Tasks / Subtasks

- [ ] **Task 1** (AC: 1): Ensure "Meu Diário" in sidebar navigates to `/` (mentee home) and updates mentorMode state
- [ ] **Task 2** (AC: 2): Add "Voltar ao Dashboard" floating button in mentee layout — only visible when user role is `mentor`
- [ ] **Task 3** (AC: 3): Verify mentee experience works identically for mentor — home, entry, reflection, history, progress all accessible
- [ ] **Task 4** (AC: 4): Verify data isolation — mentor's dashboard endpoints exclude own entries, mentor's diary shows own entries
- [ ] **Task 5** (AC: 5): Implement client-side navigation — use Next.js router for transitions without full page reload
- [ ] **Task 6** (AC: 6): Add visual mode indicator — different header color/text or badge showing current mode (Dashboard vs Meu Diário)
- [ ] **Task 7**: Update middleware to allow mentor role to access both `/dashboard` and mentee routes
- [ ] **Task 8**: Write unit tests for mode switching and role-based UI rendering

---

## CodeRabbit Integration

> **CodeRabbit Integration**: Disabled

---

## File List

_To be updated during implementation._

---

## Dev Agent Record

_To be filled by @dev during implementation._

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-02-27 | 1.0 | Story drafted | @sm |

---

## QA Results

_To be filled by @qa during review._
