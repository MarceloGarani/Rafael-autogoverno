# Story 4.3: Mentor — Evolution & Pattern Tabs

**Epic:** 4 — Intelligence & Reports
**Status:** Draft
**Priority:** High
**Story Type:** Frontend + API + Integration

---

## Executor Assignment

executor: "@dev"
quality_gate: "@architect"
quality_gate_tools: ["architecture-review", "code-standards"]

---

## Story Statement

> As a mentor,
> I want to see charts and AI-identified patterns for each mentee,
> so that I can have data-driven mentoring sessions.

---

## Acceptance Criteria

- [ ] **AC1:** Aba "Evolução" no perfil do mentorado: gráficos de intensidade ao longo do tempo, distribuição de categorias, reativo vs. estratégico — mesmos componentes da Story 4.2 reutilizados com dados do mentorado
- [ ] **AC2:** Aba "Relatórios": lista de todos os relatórios semanais do mentorado (o mentor pode abrir e ler cada um)
- [ ] **AC3:** Aba "Padrões IA": insights identificados automaticamente (ex: "Ansiedade recorrente em audiências — 80% dos registros dessa categoria têm intensidade 8+")
- [ ] **AC4:** Padrões gerados via API Route com Claude API, analisando todo o histórico do mentorado
- [ ] **AC5:** Dados atualizados dinamicamente — refletem os registros mais recentes

---

## Dev Notes

### Tab Architecture
[Source: docs/architecture.md#components]
- MenteeProfile tabs: `TabRecords` (Story 3.3), `TabEvolution`, `TabReports`, `TabPatterns`
- `TabEvolution` reuses chart components from Story 4.2 (IntensityChart, CategoryPieChart, ReactiveVsStrategicChart)
- `TabReports` displays list of WeeklyReports for this mentee
- `TabPatterns` displays AI-generated pattern insights

### API Endpoints
[Source: docs/architecture.md#api-specification]
- Existing: `GET /api/dashboard/mentees/[id]` — mentee profile
- New: `GET /api/dashboard/mentees/[id]/patterns` — AI-identified patterns. Auth: Mentor

### Patterns AI Generation
- Uses Claude API to analyze full history of a mentee
- Input: all daily_entries for the mentee
- Output: list of pattern insights (description, connection to A.D.V., supporting data)
- Cache patterns — regenerate on demand or when new entries exceed threshold (e.g., 5 new entries since last analysis)

### Component Reuse from Story 4.2
- `IntensityChart` — same component, different data source (mentee's data via mentor API)
- `CategoryPieChart` — same
- `ReactiveVsStrategicChart` — same
- Components should accept data as props, not fetch internally

### File Locations
- Tab components: `packages/web/src/components/dashboard/` — TabEvolution.tsx, TabReports.tsx, TabPatterns.tsx
- API Route: `packages/web/src/app/api/dashboard/mentees/[id]/patterns/route.ts`
- AI prompt for patterns: `packages/web/src/lib/ai/prompts.ts`
- Service: extend `dashboard-service.ts` with pattern generation

---

## Tasks / Subtasks

- [ ] **Task 1** (AC: 1): Create `TabEvolution` — reuse IntensityChart, CategoryPieChart, ReactiveVsStrategicChart with mentee data from mentor API
- [ ] **Task 2** (AC: 2): Create `TabReports` — list mentee's weekly reports (fetch from mentor API), each clickable to view full report
- [ ] **Task 3** (AC: 3, 4): Create `TabPatterns` — display AI-generated pattern insights from Claude API
- [ ] **Task 4** (AC: 4): Create API Route `GET /api/dashboard/mentees/[id]/patterns` — analyze mentee history with Claude API, return structured patterns
- [ ] **Task 5** (AC: 4): Create patterns system prompt — identify recurring emotions per category, intensity trends, behavioral patterns, A.D.V. connections
- [ ] **Task 6** (AC: 5): Implement pattern caching — store last analysis result, regenerate button for mentor
- [ ] **Task 7**: Replace placeholder tabs from Story 3.3 with functional implementations
- [ ] **Task 8**: Ensure chart components are properly parameterized (accept data as props)
- [ ] **Task 9**: Write unit tests for TabEvolution, TabReports, TabPatterns

---

## CodeRabbit Integration

> **CodeRabbit Integration**: Disabled

---

## File List

_To be updated during implementation._

---

## Dev Agent Record

_To be filled by @dev during implementation._

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-02-27 | 1.0 | Story drafted | @sm |

---

## QA Results

_To be filled by @qa during review._
