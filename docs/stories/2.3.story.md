# Story 2.3: Entry History & Details

**Epic:** 2 â€” Daily Entry & AI Reflection
**Status:** Draft
**Priority:** High
**Story Type:** Frontend + API

---

## Executor Assignment

executor: "@dev"
quality_gate: "@architect"
quality_gate_tools: ["architecture-review", "code-standards"]

---

## Story Statement

> As a mentee,
> I want to view my past entries with filters and full details,
> so that I can track my emotional patterns over time.

---

## Acceptance Criteria

- [ ] **AC1:** Rota `/history` com lista cronolÃ³gica de registros (mais recente primeiro)
- [ ] **AC2:** Cada registro exibido como card com: data, categoria (chip colorido), emoÃ§Ã£o (Ã­cone), intensidade (indicador visual 1-10)
- [ ] **AC3:** Filtros funcionais: por perÃ­odo (Ãºltima semana, Ãºltimo mÃªs, customizado), por categoria, por emoÃ§Ã£o
- [ ] **AC4:** Ao clicar em um card: expande/navega para detalhes completos â€” situaÃ§Ã£o, reaÃ§Ã£o, autopercepÃ§Ã£o, perguntas da IA e respostas do mentorado
- [ ] **AC5:** PaginaÃ§Ã£o ou infinite scroll para listas longas
- [ ] **AC6:** Estado vazio: mensagem orientativa quando nÃ£o hÃ¡ registros
- [ ] **AC7:** Dados carregados via API Route (`GET /api/entries`) com filtros como query params
- [ ] **AC8:** Loading states e error handling adequados

---

## Dev Notes

### Wireframe â€” History/Timeline
[Source: docs/architecture/wireframes-mvp-phase1.md#9-history-timeline]
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â†  Meu HistÃ³rico              â”‚
â”‚                                â”‚
â”‚  Filtros                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚Semanaâ”‚ â”‚ MÃªs  â”‚ â”‚Customâ”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚Categ.â”‚ â”‚EmoÃ§Ã£oâ”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  27 fev Â· AudiÃªncia    â”‚    â”‚
â”‚  â”‚  ðŸ˜° Ansiedade  â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 7â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  26 fev Â· Cliente      â”‚    â”‚
â”‚  â”‚  ðŸ˜¡ Raiva      â–ˆâ–ˆâ–‘â–‘â–‘â–‘ 4â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  25 fev Â· NegociaÃ§Ã£o   â”‚    â”‚
â”‚  â”‚  ðŸ˜¨ Medo       â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘ 9â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### API Endpoint
[Source: docs/architecture.md#api-specification]
- `GET /api/entries` â€” returns paginated entries for authenticated user
- Query params: `period` (week|month|custom), `start_date`, `end_date`, `category`, `emotion`, `page` (default 1), `limit` (default 20)
- Response includes entry + joined ai_reflections data

### Component Specs
[Source: docs/architecture.md#components]
- History Browser: `HistoryList`, `EntryCard`, `EntryDetail`, `FilterBar`
- Dependencies: React Query, API route `/api/entries`
- Technology: Server Components for initial list, Client Components for filters and interactions

### Data Model
[Source: docs/architecture.md#data-models]
- Entry card shows: date, category (chip), emotion (icon), intensity (bar/visual 1-10)
- Detail view shows: situation, reaction, self_perception, ai_reflections.questions, ai_reflections.answers

### File Locations
- Page: `packages/web/src/app/(mentee)/history/page.tsx`
- Components: `packages/web/src/components/history/` â€” HistoryList.tsx, EntryCard.tsx, EntryDetail.tsx, FilterBar.tsx
- API Route: `packages/web/src/app/api/entries/route.ts` (GET handler â€” extends existing route)
- Hook: `packages/web/src/hooks/use-entries.ts`

---

## Tasks / Subtasks

- [ ] **Task 1** (AC: 7): Extend API Route `GET /api/entries` â€” add filter support (period, category, emotion), pagination (page, limit), include joined ai_reflections
- [ ] **Task 2** (AC: 3): Create `FilterBar` component â€” period chips (Semana, MÃªs, Custom), category dropdown, emotion dropdown
- [ ] **Task 3** (AC: 2): Create `EntryCard` component â€” date, category chip (colored), emotion icon, intensity bar (visual 1-10 with color gradient)
- [ ] **Task 4** (AC: 1): Create `HistoryList` component â€” chronological list of EntryCards (most recent first)
- [ ] **Task 5** (AC: 4): Create `EntryDetail` component â€” full view with situation, reaction, self_perception, AI questions + answers (expandable or separate view)
- [ ] **Task 6** (AC: 5): Implement pagination â€” "Carregar mais" button or infinite scroll using React Query `useInfiniteQuery`
- [ ] **Task 7** (AC: 6): Implement empty state â€” "Nenhum registro encontrado" with CTA link to `/entry/new`
- [ ] **Task 8** (AC: 8): Add loading skeletons for entry cards and error handling with retry
- [ ] **Task 9**: Create `useEntries` React Query hook with filter parameters
- [ ] **Task 10**: Write unit tests for FilterBar, EntryCard, and pagination logic

---

## CodeRabbit Integration

> **CodeRabbit Integration**: Disabled

---

## File List

_To be updated during implementation._

---

## Dev Agent Record

_To be filled by @dev during implementation._

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-02-27 | 1.0 | Story drafted | @sm |

---

## QA Results

_To be filled by @qa during review._
